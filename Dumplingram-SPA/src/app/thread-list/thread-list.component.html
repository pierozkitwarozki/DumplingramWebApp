<div id="threads" class="card m-5 p-5">
  <h1
    style="font-family: 'Roboto Slab'; font-size: xx-large; font-weight: bold"
    class="mb-5"
  >
    Konwersacje prywatne
  </h1>
  <div id="avatar-section" class="mb-4" *ngFor="let message of (presenceService.conversations$ | async)">
    <!--follow-image-->
    <div
      id="conv"
      *ngIf="!isLastMessageFromMe(message)"
      (click)="openConversation(message.senderId, template)"
    >
      <img id="follow-image" src="{{ message.senderPhotoUrl || '../../assets/user.png'}}" />
      <div>
        <b class="w-100"
          ><p id="name">{{ message.content }}</p>
          @{{ message.senderUsername }}</b
        >
        <p id="name" style="display: flex; justify-content: flex-end">
          {{ message.messageSent | date: "mediumDate" }}
        </p>
      </div>
    </div>

    <div
      id="conv"
      *ngIf="isLastMessageFromMe(message)"
      (click)="openConversation(message.recipientId, template)"
    >
      <img id="follow-image" src="{{ message.recipientPhotoUrl || '../../assets/user.png'}}" />
      <div>
        <b class="w-100"
          ><p id="name">{{ message.content }}</p>
          @{{ message.recipientUsername }}</b
        >
        <p id="name" style="display: flex; justify-content: flex-end">
          {{ message.messageSent | date: "mediumDate" }}
        </p>
      </div>
    </div>
  </div>
</div>

<ng-template #template>
  <div class="modal-header">
    <div>
      <img
        [routerLink]="['/users/', user.id]"
        id="avatar"
        src="{{ user.photoUrl || '../../assets/user.png'}}"
        style="width: 14%; height: 14%; border-radius: 90px; cursor: pointer;"
        (click)="modalRef.hide()"
      />
      <label
        for="avatar"
        style="font-size: large; font-family: 'Roboto Slab'; font-weight: bold"
        class="ml-2"
        >{{ user.name }} {{ user.surname }}</label
      >
      <span
        *ngIf="
          (presenceService.onlineUsers$ | async).includes(user.id.toString())
        "
        style="margin-left: 20px;"
        [class.is-online]="
          (presenceService.onlineUsers$ | async).includes(user.id.toString())
        "
      >
        <i class="fa fa-circle"></i>
      </span>
    </div>
  </div>
  <div class="modal-body" #scrollMe [scrollTop]="scrollMe.scrollHeight">
      <div
      #messages
      class="talk-bubble tri-right left-top"
      *ngFor="let message of (messageService.messageThread$ | async)"
    >
      <div *ngIf="isFromMe(message)" class="mine messages">
        <div class="message">
          {{ message.content }}
        </div>
      </div>

      <div *ngIf="!isFromMe(message)" class="yours messages">
        <div class="message">
          {{ message.content }}
        </div>
      </div>
    </div>
    
  </div>
  <div class="modal-footer">
    <div class="container text-center">      
        <input
        #message
        [(ngModel)]="messageContent"
          class="float-left"
          placeholder="Wiadomość..."
          (keyup)="onKey($event)"
        /> {{ message.focus() }}
        <button class="float-right" type="submit" (click)="sendMessage()">Wyślij</button>           
    </div>
  </div>
</ng-template>
